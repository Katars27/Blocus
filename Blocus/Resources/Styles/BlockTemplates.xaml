<?xml version="1.0" encoding="utf-8" ?>
<ResourceDictionary
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:Blocus.ViewModels"
    xmlns:helpers="clr-namespace:Blocus.Helpers">

    <!--
    ==============================
    Ð¢Ð•ÐšÐ¡Ð¢ÐžÐ’Ð«Ð™ Ð‘Ð›ÐžÐš (TEXT BLOCK)
    ==============================
    -->
    <DataTemplate x:Key="TextBlockTemplate" x:DataType="viewmodels:BlockViewModel">
        <Frame
            Style="{StaticResource CardStyle}"
            Margin="{Binding Level, Converter={StaticResource LevelToMarginConverter}}">

            <!-- Ð’Ð½ÑƒÑ‚Ñ€Ð¸ Ñ„Ñ€ÐµÐ¹Ð¼Ð°: ÑÐºÑ€Ð¾Ð»Ð»Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ð¹ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚ÐµÐº -->
            <ScrollView Orientation="Vertical">
                <VerticalStackLayout Spacing="4">

                    <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð±Ð»Ð¾ÐºÐ° -->
                    <Label
                        Text="{Binding Title}"
                        FontSize="18"
                        FontAttributes="Bold"
                        TextColor="#e3e0f3"
                        Margin="0,0,0,2"
                        LineBreakMode="WordWrap"
                        HorizontalOptions="FillAndExpand" />

                    <!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ -->
                    <Editor
                        Text="{Binding Content}"
                        FontSize="15"
                        TextColor="#c8c8e0"
                        BackgroundColor="Transparent"
                        IsReadOnly="True"
                        HeightRequest="100"
                        Margin="8,2,0,2"
                        AutoSize="Disabled" />

                    <!-- Ð¢Ð¸Ð¿ Ð±Ð»Ð¾ÐºÐ° (Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸/Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ) -->
                    <Label
                        Text="{Binding Type}"
                        FontSize="12"
                        TextColor="#9887d6"
                        Margin="8,0,0,2" />

                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ (ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ, Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ, ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ) -->
                    <HorizontalStackLayout Spacing="6">
                        <Button
                            Text="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ"
                            Command="{Binding OpenCommand}"
                            Style="{StaticResource FabButtonStyle}"
                            WidthRequest="100"
                            HeightRequest="50"
                            FontSize="16" />
                        <Button
                            Text="+"
                            Command="{Binding AddChildBlockCommand}"
                            Style="{StaticResource FabButtonStyle}"
                            WidthRequest="50"
                            HeightRequest="50"
                            FontSize="20" />
                        <Button
                            Text="ðŸ—‘"
                            Command="{Binding DeleteCommand}"
                            Style="{StaticResource FabButtonStyle}"
                            WidthRequest="40"
                            HeightRequest="40"
                            FontSize="16" />
                    </HorizontalStackLayout>

                    <!-- Ð”Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ðµ Ð±Ð»Ð¾ÐºÐ¸ (Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ ÐµÑÐ»Ð¸ IsExpanded) -->
                    <CollectionView
                        ItemsSource="{Binding Children}"
                        ItemTemplate="{StaticResource BlockTemplateSelector}"
                        IsVisible="{Binding IsExpanded}" />

                </VerticalStackLayout>
            </ScrollView>
        </Frame>
    </DataTemplate>

    <!--
    ======================================
    Ð§Ð•ÐšÐ‘ÐžÐšÐ¡-Ð‘Ð›ÐžÐš (CHECKBOX BLOCK)
    ======================================
    -->
    <DataTemplate x:Key="CheckboxBlockTemplate" x:DataType="viewmodels:BlockViewModel">
        <Frame
            Style="{StaticResource CardStyle}"
            Margin="{Binding Level, Converter={StaticResource LevelToMarginConverter}}">

            <ScrollView Orientation="Vertical">
                <VerticalStackLayout Spacing="4">

                    <!-- Ð“Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚ÐµÐº: Ñ‡ÐµÐºÐ±Ð¾ÐºÑ + Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                    <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                        <CheckBox
                            IsChecked="{Binding IsChecked, Mode=TwoWay}"
                            Color="#bfaaff"
                            VerticalOptions="Center" />
                        <Label
                            Text="{Binding Title}"
                            FontSize="18"
                            FontAttributes="Bold"
                            LineBreakMode="WordWrap"
                            TextColor="#e3e0e0"
                            VerticalOptions="Center"
                            HorizontalOptions="FillAndExpand" />
                    </HorizontalStackLayout>

                    <!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ -->
                    <Editor
                        Text="{Binding Content}"
                        FontSize="15"
                        TextColor="#c8c8e0"
                        BackgroundColor="Transparent"
                        IsReadOnly="True"
                        HeightRequest="68"
                        Margin="8,2,0,2"
                        AutoSize="Disabled" />

                    <!-- Ð”Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ðµ Ð±Ð»Ð¾ÐºÐ¸ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ) -->
                    <CollectionView
                        ItemsSource="{Binding Children}"
                        ItemTemplate="{StaticResource BlockTemplateSelector}"
                        Margin="12,4,0,0"
                        IsVisible="{Binding IsExpanded}" />

                </VerticalStackLayout>
            </ScrollView>
        </Frame>
    </DataTemplate>

    <!--
    ===========================
    PAGE-Ð‘Ð›ÐžÐš (PAGE BLOCK)
    ===========================
    -->
    <DataTemplate x:Key="PageBlockTemplate" x:DataType="viewmodels:BlockViewModel">
        <Frame
            Style="{StaticResource CardStyle}"
            Margin="{Binding Level, Converter={StaticResource LevelToMarginConverter}}">

            <VerticalStackLayout Spacing="4">

                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ -->
                <Label
                    Text="{Binding Title}"
                    FontSize="22"
                    FontAttributes="Bold"
                    TextColor="#e3e0f3"
                    Margin="0,0,0,2"
                    LineBreakMode="WordWrap"
                    HorizontalOptions="FillAndExpand" />

                <!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ -->
                <Editor
                    Text="{Binding Content}"
                    FontSize="15"
                    TextColor="#c8c8e0"
                    BackgroundColor="Transparent"
                    IsReadOnly="True"
                    HeightRequest="68"
                    Margin="8,2,0,6"
                    AutoSize="Disabled" />

                <!-- Ð”Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ðµ Ð±Ð»Ð¾ÐºÐ¸, Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð¾ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, "ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹") -->
                <CollectionView
                    ItemsSource="{Binding Children}"
                    ItemTemplate="{StaticResource BlockTemplateSelector}"
                    Margin="8,2,0,0"
                    ItemsLayout="HorizontalList"
                    IsVisible="{Binding IsExpanded}" />

            </VerticalStackLayout>
        </Frame>
    </DataTemplate>

    <!--
    ===========================================
    Ð¡Ð•Ð›Ð•ÐšÐ¢ÐžÐ  Ð¨ÐÐ‘Ð›ÐžÐÐžÐ’ Ð‘Ð›ÐžÐšÐžÐ’ (TEMPLATE SELECTOR)
    ===========================================
    -->
    <helpers:BlockTemplateSelector
        x:Key="BlockTemplateSelector"
        TextTemplate="{StaticResource TextBlockTemplate}"
        CheckboxTemplate="{StaticResource CheckboxBlockTemplate}"
        PageTemplate="{StaticResource PageBlockTemplate}" />

</ResourceDictionary>
